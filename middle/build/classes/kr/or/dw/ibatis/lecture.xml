<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="lecture">
	
	<select id="getAllLecture" parameterClass="String" resultClass="lecVO">
		SELECT lec_code
			 , MAX(lec_name) lec_name
			 , max(staff_id) staff_id
			 , max(staff_name) staff_name
			 , max(lec_loc) lec_loc
			 , max(lec_day) lec_day
			 , min(lec_time) lec_time
			 , count(lec_time) lec_hour
			 , max(lec_credit) lec_credit
			 , max(lec_year) lec_year
			 , max(lec_div) lec_div
			 , max(lec_term) lec_term
			 , max(plan_path) plan_path
			 , max(stu_score) stu_score
			 , max(stu_grade) stu_grade
		FROM (
				SELECT a.lec_code, lec_name, l.STU_ID, a.staff_id, staff_name, lec_loc, lec_day, lec_time, lec_div, lec_credit, lec_year, lec_term, stu_score, stu_grade, plan_path
				FROM lecture l, ALL_LECTURELIST a, STAFFS s 
				WHERE l.LEC_CODE = a.LEC_CODE 
				AND a.staff_id = s.STAFF_ID 
				AND STU_ID = #stu_id#
				ORDER BY lec_year DESC, lec_term DESC, LEC_CODE
				)
		GROUP BY lec_code
	</select>
	
	<select id="selecteLecCode" resultClass="String">
		SELECT ('C' || LPAD(lec_seq.nextval, 5, '0'))
		FROM dual
	</select>
	
	<insert id="insertLecture" parameterClass="lecVO">
		INSERT INTO all_lecturelist 
		(lec_code, lec_name, staff_id, lec_loc, lec_year, lec_term, lec_day, lec_time, lec_div, lec_credit, lec_maxpeo)
		VALUES 
		(#lec_code#, #lec_name#, #staff_id#, #lec_loc#, #lec_year#, #lec_term#, #lec_day#, #lec_time#, #lec_div#, #lec_credit#, #lec_maxpeo#)
	</insert>
	
	<select id="staffLecList" parameterClass="String" resultClass="lecVO">
		SELECT lec_code
			 , MAX(lec_name) lec_name
			 , max(staff_id) staff_id
			 , max(lec_loc) lec_loc
			 , max(lec_day) lec_day
			 , min(lec_time) lec_time
			 , count(lec_time) lec_hour
			 , max(lec_credit) lec_credit
			 , max(lec_year) lec_year
			 , max(plan_path) plan_path
			 , max(lec_div) lec_div
			 , max(lec_term) lec_term
		FROM (
				SELECT lec_code, lec_name, staff_id, lec_loc, lec_day, lec_time, lec_div, lec_credit, lec_year, lec_term, plan_path
				FROM ALL_LECTURELIST
				WHERE staff_id = #staff_id#
				ORDER BY lec_year DESC, lec_term DESC, LEC_CODE
				)
		GROUP BY lec_code
	</select>
	
	<select id="selectLecture" parameterClass="String" resultClass="lecVO">
		SELECT lec_code
			 , MAX(lec_name) lec_name
			 , max(lec_loc) lec_loc
			 , max(lec_day) lec_day
			 , min(lec_time) lec_time
			 , count(lec_time) lec_hour
			 , max(lec_credit) lec_credit
			 , max(lec_year) lec_year
			 , max(lec_div) lec_div
			 , max(lec_term) lec_term
			 , max(lec_maxpeo) lec_maxpeo
		FROM (
				SELECT lec_code, lec_name, lec_loc, lec_day, lec_time, lec_div, lec_credit, lec_year, lec_term, lec_maxpeo
				FROM ALL_LECTURELIST 
				WHERE lec_code = #lec_code#
				ORDER BY lec_year DESC, lec_term DESC, LEC_CODE
				)
		GROUP BY lec_code
	</select>
	
	<delete id="deleteLecture" parameterClass="String">
		DELETE all_lecturelist WHERE lec_code = #lec_code#
	</delete>
	
	<select id="getLectureStudent" parameterClass="String" resultClass="lecVO">
		SELECT l.stu_id, stu_name, dept_name, stu_score, stu_grade
		FROM lecture l, students s, dept d
		WHERE l.stu_id = s.stu_id
		AND s.DEPT_CODE = d.DEPT_CODE
		AND lec_code = #lec_code#
	</select>
	
	<update id="updateScore" parameterClass="lecVO">
		UPDATE lecture SET stu_score = #stu_score#, stu_grade = #stu_grade#
		WHERE stu_id = #stu_id# 
		AND lec_code = #lec_code#
	</update>
	
	<update id="updatePlanFile" parameterClass="lecVO">
		UPDATE all_lecturelist SET plan_path = #plan_path# WHERE lec_code = #lec_code#
	</update>
	
</sqlMap>