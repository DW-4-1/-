<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="board">

	<select id="selectBoardList" parameterClass="Map" resultClass="boardVO">
		SELECT bd_no, bd_title, bd_content, bd_wdt, bd_hit
		FROM (
				SELECT *
				FROM (
					  SELECT rownum rnum, v1.*
					  FROM (
							SELECT *
							FROM notice_board
					  		WHERE gb_del = 'N'
					  		ORDER BY bd_no DESC
					  		) v1
					  WHERE rownum <![CDATA[ <= ]]> #end#
					  ) v2
				WHERE v2.rnum <![CDATA[ >= ]]> #start#
			) b
	</select>
	
	<select id="selectBoardCount" resultClass="int">
		SELECT COUNT(*) cnt
		FROM notice_board
		WHERE gb_del = 'N'
	</select>
	
	<select id="getBulletinBoardView" parameterClass="int" resultClass="boardVO">
		SELECT *
		FROM notice_board
		WHERE bd_no = #bd_no#
	</select>

	<update id="deleteBulletinContent" parameterClass="int">
		UPDATE notice_board SET gb_del = 'Y' WHERE bd_no = #bd_no#
	</update>
	
	<insert id="insertBulletinContent" parameterClass="boardVO">
		<selectKey keyProperty="bd_no" resultClass="int">
			SELECT notice_board_seq.nextval bd_no FROM dual
		</selectKey>
		
		INSERT INTO 
			notice_board (
						bd_no
					   ,bd_title
					   ,bd_content
					   ,staff_id
					   ,bd_wdt
					   ,bd_hit
					   ,gb_del
				
					)
			VALUES (
						#bd_no#
					   ,#bd_title#
					   ,#bd_content#
					   ,#staff_id#
					   ,sysdate
					   ,0
					   ,'N'
					)
			
	</insert>
	
	<update id="updateBulletinContent" parameterClass="boardVO">
		UPDATE notice_board SET bd_title = #bd_title#, bd_content = #bd_content#
		WHERE bd_no = #bd_no#
	</update>
	
	<update id="hitBulletinBoard" parameterClass="int">
		UPDATE notice_board SET bd_hit = bd_hit + 1 WHERE bd_no = #bd_no#
	</update>
	
	<select id="selectStuBoardList" parameterClass="Map" resultClass="boardVO">
		SELECT bd_no, bd_title, bd_content, bd_wdt, bd_hit, b.stu_id, stu_name
		FROM (
				SELECT *
				FROM (
					  SELECT rownum rnum, v1.*
					  FROM (
							SELECT *
							FROM stu_board
					  		WHERE gb_del = 'N'
					  		ORDER BY bd_no DESC
					  		) v1
					  WHERE rownum <![CDATA[ <= ]]> #end#
					  ) v2
				WHERE v2.rnum <![CDATA[ >= ]]> #start#
			) b, students s
		WHERE b.stu_id = s.stu_id
	</select>
	
	<select id="selectStuBoardCount" resultClass="int">
		SELECT COUNT(*) cnt
		FROM stu_board
		WHERE gb_del = 'N'
	</select>
	
	<select id="getStuBoardView" parameterClass="int" resultClass="boardVO">
		SELECT b.*, stu_name
		FROM stu_board b, students s
		WHERE b.stu_id = s.stu_id
		AND bd_no = #bd_no#
	</select>

	<update id="deleteStuContent" parameterClass="int">
		UPDATE stu_board SET gb_del = 'Y' WHERE bd_no = #bd_no#
	</update>
	
	<insert id="insertStuContent" parameterClass="boardVO">
		<selectKey keyProperty="bd_no" resultClass="int">
			SELECT stu_board_seq.nextval bd_no FROM dual
		</selectKey>
		
		INSERT INTO 
			stu_board (
						bd_no
					   ,bd_title
					   ,bd_content
					   ,stu_id
					   ,bd_wdt
					   ,bd_hit
					   ,gb_del
				
					)
			VALUES (
						#bd_no#
					   ,#bd_title#
					   ,#bd_content#
					   ,#stu_id#
					   ,sysdate
					   ,0
					   ,'N'
					)
			
	</insert>
	
	<update id="updateStuContent" parameterClass="boardVO">
		UPDATE stu_board SET bd_title = #bd_title#, bd_content = #bd_content#
		WHERE bd_no = #bd_no#
	</update>
	
	<update id="hitStuBoard" parameterClass="int">
		UPDATE stu_board SET bd_hit = bd_hit + 1 WHERE bd_no = #bd_no#
	</update>
	
	<select id="selectStaffInfo" resultClass="replyVO">
		SELECT sbr.*, s.staff_name
		  FROM stu_board_re sbr, staffs s
		 WHERE sbr.staff_id = s.staff_id
	</select>
</sqlMap>